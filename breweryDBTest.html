<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Single AJAX</title>
</head>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
        // constructing a queryURL variable we will use instead of the literal string inside of the ajax method

        var queryURL1 = 'https://api.brewerydb.com/v2/search/geo/point?key=';
        var apiKey = '7666aff49d47c147ba22244312acf587';
        var queryURL2 = '&lat=';
        var testLatitude = '35.4303824';
        var queryURL3 = '&lng=';
        var testLongitude = '-82.5489214';
        var queryURL4 = '&radius=';
        var testRadius = 20;

        //INSERT CODE TO USE ZIPCODES PACKAGE
        //var zipcodes = require('zipcodes');
        //var oldCityPhillyZip = zipcodes.lookup(19106);
        //console.log('Old City Latitude: ' + oldCityPhillyZip.latitude);


        //This function gets Brewery records from the API based on provided location(latitude, longitude) and search radius in miles
        function getBreweries(latitude, longitude, radius) {
            console.log('testing getBreweries function');
            var queryURL = queryURL1 + apiKey + queryURL2 + latitude + queryURL3 + longitude + queryURL4 + radius;
            const apiKeyProxy =
                'gMIHJxXUTxTdI3_v6Rnzo7uD3wZQcQ4sYrppHS3xRRGQM7iRvtaCPunKOB1auZmzlxJG2cvpmhPNc2WPRaxux6DYqUKT15Cxu_U5pF9bsOe--uerTHBNZ-x3LvXYW3Yx';
            const proxyUrl = 'https://shielded-hamlet-43668.herokuapp.com/';
            $.ajax({
                async: false,
                url: proxyUrl + queryURL,
                method: "GET",
                headers: {
                    authorization: 'Bearer ' + apiKeyProxy
                }
            }).then(function (response) {
                console.log("This is the response from Brewery DB");
                console.log(response.data);

                var responseArray = new Array;
                for (i = 0; i < response.data.length; i++) {
                    responseArray[i] = response.data[i];
                    console.log('This is element ' + i + ' of the Breweries Array');
                    console.log(response.data[i]);
                }

                return responseArray;
            });
        }

        getBreweries(testLatitude, testLongitude, testRadius);
    </script>

</body>